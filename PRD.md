# KIS Quant (가칭) PRD - MVP 최종 버전

## 1. 제품 개요

**제품명:** KIS Quant (가칭)

**제품 목적:** 'KIS Quant'는 한국투자증권의 오픈API와 **사용자가 직접 구성하고 관리하는 Firebase 데이터베이스**를 활용하여, 개인 투자자들이 **퀀트 투자 전략을 백테스트하고 자동매매를 실행**할 수 있도록 돕는 웹 기반 통합 금융 기술 플랫폼입니다. 이 MVP는 사용자가 자신의 데이터 소유권을 가지면서도, 코딩 지식 없이 쉽게 자신만의 투자 전략을 검증하고 실제 시장에 적용하여 효율적인 자산 운용을 시작할 수 있는 **최소한의 핵심 기능**을 제공하는 데 중점을 둡니다.

**해결하려는 문제점:**
* **높은 퀀트 투자 진입 장벽:** 일반 투자자들은 퀀트 투자를 위한 코딩 지식, 데이터 분석 능력, 시스템 구축 등에 어려움을 겪습니다.
* **투자 전략 검증의 어려움:** 개인 투자자들이 자신의 투자 아이디어를 과거 데이터에 기반하여 효과적으로 검증하기 위한 도구가 부족합니다.
* **수동 매매의 한계:** 감정적 판단, 실시간 대응의 어려움 등으로 인해 투자 기회를 놓치거나 손실을 볼 수 있습니다.

**제공하는 가치 제안 (MVP):**
* **개인 데이터 소유권 보장:** 사용자가 직접 Firebase DB를 구성하고 인증 정보를 앱에 입력하여 자신의 전략, 백테스트 결과, 매매 로그 등 모든 데이터를 직접 관리합니다.
* **코딩 없는 퀀트 투자 시작:** 직관적인 UI를 통해 누구나 쉽게 자신만의 퀀트 전략을 구축하고 백테스트할 수 있습니다.
* **간편한 백테스팅 및 검증:** 한국 및 미국 주식/ETF 데이터를 기반으로 전략의 과거 성과를 빠르게 확인하여 투자 아이디어를 검증합니다.
* **전략 기반 자동매매:** 검증된 전략을 한국투자증권 계좌와 연동하여 자동으로 매매를 실행함으로써 감정적인 요소 없이 투자할 수 있습니다.

---

## 2. 대상 사용자

* **초보 퀀트 투자자:** 퀀트 투자에 관심은 있지만 코딩 지식이 부족하여 시작에 어려움을 겪는 사용자. 이들은 직관적인 인터페이스를 통해 퀀트 투자를 경험하고 싶어 합니다.
* **기존 개인 투자자 (주식/ETF 투자 경험자):** 주식이나 ETF 투자 경험은 있지만, 더 체계적이고 자동화된 투자 방법을 모색하는 사용자. 이들은 자신의 투자 아이디어를 데이터 기반으로 검증하고 자동매매를 통해 시간과 노력을 절약하고자 합니다.

---

## 3. 사용자 흐름 (MVP 버전)

**주요 사용자 시나리오: '사용자 맞춤형 DB 및 API 키 설정 후 단일 종목 전략 실행'**

1.  **초기 접속 및 설정 페이지 진입:**
    * 사용자는 웹앱에 접속합니다.
    * 서비스 이용 전 '설정' 페이지로 이동하도록 안내하거나, 초기 접속 시 설정 페이지가 먼저 나타나도록 합니다.
2.  **Firebase DB 인증 정보 및 한국투자증권 API 키 입력:**
    * 설정 페이지에서 다음 입력 필드를 확인합니다:
        * `FIREBASE_API_KEY`
        * `FIREBASE_AUTH_DOMAIN`
        * `FIREBASE_PROJECT_ID`
        * `FIREBASE_STORAGE_BUCKET` (MVP에서는 활용하지 않을 수 있으나, 필드 포함)
        * `FIREBASE_MESSAGING_SENDER_ID` (MVP에서는 활용하지 않을 수 있으나, 필드 포함)
        * `FIREBASE_APP_ID`
        * `한국투자증권 AppKey`
        * `한국투자증권 AppSecret`
    * 사용자는 **별도로 생성한 Firebase 프로젝트의 인증 정보**와 **본인의 한국투자증권 API 키**를 각 필드에 입력합니다.
    * **'설정 저장 및 연결' 버튼을 클릭**하여 유효성을 검증하고 Firebase 및 한국투자증권 API에 연결을 시도합니다.
    * **성공 시:** Firebase 연결 후 API 키 정보가 **사용자 Firebase DB에 암호화되어 저장**되고 대시보드 화면으로 진입합니다.
    * **실패 시:** 오류 메시지를 표시하고 재입력을 요청합니다.
3.  **새 전략 생성 (단일 종목 위주):**
    * 사용자는 좌측 메뉴에서 **'새 전략 생성' 버튼을 클릭**합니다.
    * 전략 생성 페이지에서 **전략 이름, 설명, 투자 대상 종목(한국/미국 주식 또는 ETF 중 1개 선택)** 등을 입력합니다.
4.  **전략 조건 설정 (간소화된 지표):**
    * 사용자는 **'전략 조건 설정'** 섹션에서 매수/매도 조건을 설정합니다.
    * **제공되는 기본 지표(예: 이동평균선, RSI) 중 하나를 선택**하고, 해당 지표의 파라미터(예: 이동평균선 기간)와 조건(예: 상향/하향 돌파, 특정 값 이상/이하)을 설정합니다.
    * **매수 조건과 매도 조건을 각각 설정**합니다. (예: 5일 이동평균선이 20일 이동평균선 상향 돌파 시 매수)
    * **단순 손절/익절 비율(%)을 설정**합니다. (예: 손절 -5%, 익절 +10%)
5.  **백테스트 실행:**
    * 전략 조건 설정 완료 후 **'백테스트 실행' 버튼을 클릭**합니다.
    * 백테스트 기간을 설정하고, 초기 투자 금액을 입력합니다.
    * 시스템은 설정된 조건과 **한국투자증권 API에서 조회한 과거 데이터**를 기반으로 백테스트를 수행합니다.
    * **핵심 결과(총 수익률, 최대 낙폭(MDD), 총 거래 횟수)**를 간단한 그래프와 표 형태로 제공하며, 이 결과는 **사용자 Firebase DB에 저장**됩니다.
6.  **백테스트 결과 확인 및 배포:**
    * 사용자는 백테스트 결과를 확인하고, 결과에 만족하면 **'실제 매매 배포' 버튼을 클릭**합니다.
    * 실제 투자할 금액을 설정하고, '자동매매 시작' 버튼을 클릭하면, 설정된 전략에 따라 실제 시장에서 자동으로 매매가 이루어집니다. (이때도 한국투자증권 API 호출은 백엔드/서버리스 함수를 통해 이루어짐)
7.  **실시간 성과 모니터링:**
    * 대시보드 또는 '내 전략' 페이지에서 **사용자 Firebase DB에 저장된 데이터를 기반으로** 현재 실행 중인 전략의 실시간 수익률, 잔고, 최근 매매 내역 등을 모니터링합니다.
    * 필요시 언제든지 자동매매를 일시 중지하거나 종료할 수 있습니다.

---

## 4. 기능 요구사항 (MVP)

| 기능 구분 | 기능명 | 상세 설명 | 개발 난이도 | 우선순위 |
| :-------- | :----- | :-------- | :---------- | :------- |
| **핵심 기능** | **초기 설정 및 DB/API 키 입력** | 앱 접속 시 또는 설정 메뉴에서 **사용자가 직접 생성한 Firebase 프로젝트의 인증 정보(`FIREBASE_API_KEY` 등 6가지)와 한국투자증권 `AppKey`, `AppSecret`을 입력**하고 저장하는 UI. Firebase 연결 후 **API 키 정보는 사용자 Firebase DB에 암호화하여 저장**됨. | 보통 | 상 |
| | **대시보드** | 사용자 Firebase DB에 저장된 데이터를 기반으로, 현재 총 자산 현황, 실행 중인 전략 목록 및 각 전략의 실시간 요약 성과(수익률, 현재가 등)를 한눈에 볼 수 있는 화면. | 보통 | 상 |
| | **전략 생성 및 관리** | 사용자가 직관적인 UI로 **새로운 전략을 생성, 수정, 삭제**할 수 있는 기능. 전략 정보는 **사용자 Firebase DB에 저장**됨. **단일 종목/ETF**를 대상으로 함. | 보통 | 상 |
| | **간소화된 전략 조건 설정** | 매수/매도 조건을 설정할 수 있는 UI. **이동평균선, RSI 등 최소한의 필수 지표**만 제공하고, **직관적인 조건식 빌더**를 통해 매수/매도 조건을 구성. **단순 손절/익절 비율(%) 설정** 포함. | 보통 | 상 |
| | **백테스팅 엔진 (단일 자산)** | 설정된 전략 조건과 **한국/미국 주식/ETF의 과거 데이터**를 기반으로 백테스팅을 수행. 백테스트 데이터는 **한국투자증권 API에서 직접 조회**하거나, 필요시 백엔드 프록시를 통해 조회. **핵심 성과 지표(총 수익률, 최대 낙폭(MDD), 총 거래 횟수)**만 제공하며, 결과는 간단한 차트와 표로 시각화. 이 결과는 **사용자 Firebase DB에 저장**됨. | 어려움 | 상 |
| | **한국/미국 주식/ETF 데이터 연동** | 한국투자증권 오픈API를 통해 한국 및 미국 시장의 실시간 및 과거 **주식/ETF 데이터**를 가져와 전략 생성 및 백테스팅에 활용. **(주로 백엔드/서버리스 프록시를 통해 이루어짐)** | 보통 | 상 |
| | **자동매매 실행 및 제어** | 백테스팅으로 검증된 전략을 한국투자증권 API와 연동하여 **실시간으로 자동 매매를 실행**. **매매 시작/일시 중지/종료** 기능 제공. 매매 실행 로직은 **백엔드/서버리스 함수에서 실행**되며, **사용자 Firebase DB에 저장된 키를 사용**. | 어려움 | 상 |
| | **매매 로그 및 실시간 성과 모니터링** | 자동매매로 발생한 모든 매매 내역(체결가, 수량, 시간 등)을 **사용자 Firebase DB에 기록**하고, 전략별 실시간 수익률 및 현재 잔고를 확인할 수 있는 기능. | 보통 | 상 |
| **부가 기능** | **API 연동 상태 표시** | 한국투자증권 오픈API 및 Firebase DB의 현재 연결 상태를 사용자에게 명확히 표시하고, 연결 끊김 시 재연결 시도 또는 안내. | 쉬움 | 중 |
| | **가상 투자 (모의 투자)** | 실제 자금 없이 전략을 테스트해 볼 수 있는 모의 투자 기능. (MVP에서는 필수 아님, 여유 시 고려) | 보통 | 중 |

---

## 5. 추천 기술 스택 (MVP)

* **프론트엔드 (Frontend):**
    * **언어:** TypeScript
    * **프레임워크:** React (또는 Vue.js)
    * **UI 라이브러리:** Chakra UI, Vuetify, 또는 Ant Design
    * **상태 관리:** Zustand (React) 또는 Pinia (Vue.js)
    * **로컬 데이터 저장 (보안 강화):** **IndexedDB** (암호화된 Firebase/한국투자증권 API 키 저장)
* **백엔드 (Backend) / 서버리스 (Serverless):**
    * **언어:** Python (선호) 또는 Node.js
    * **프레임워크:** **Vercel Serverless Functions** (한국투자증권 API 호출 프록시, 가벼운 백테스트 데이터 조회), **별도 백엔드 서버 (AWS Lambda, EC2 등) :** 장기 실행이 필요한 자동매매 실행, 복잡한 백테스팅 로직 (Vercel Serverless Functions의 실행 시간 제한 및 비용 효율성 고려하여 필수적으로 별도 서버 고려)
    * **API 연동:** `requests` (Python) 또는 `axios` (Node.js)
    * **데이터 분석/퀀트 라이브러리:** Pandas, NumPy (Python)
* **데이터베이스 (Database):**
    * **Firebase Firestore:** 전략 설정, 백테스트 결과, 매매 로그, 암호화된 사용자 API 키 및 Firebase 인증 정보 저장.
    * **Firebase Realtime Database (선택적):** 실시간 매매 현황, 알림 등 실시간 동기화 필요 데이터.

---

## 6. 보안 강화 상세 (MVP)

사용자에게 Firebase DB를 직접 구성하도록 하는 새로운 방향에 맞춰, 앱 내에서 입력되는 민감 정보의 보안을 최우선으로 고려합니다.

* **API 키 저장:**
    * 사용자가 입력하는 한국투자증권 `AppKey`, `AppSecret`은 **사용자 Firebase DB에 암호화하여 저장**합니다.
    * Firebase 프로젝트 인증 정보(`FIREBASE_API_KEY` 등)는 Firebase 연결을 위해 필요하며, 연결 후에는 API 키만 암호화하여 DB에 저장합니다.
    * 저장 시에는 반드시 **강력한 암호화 알고리즘(예: AES-GCM)**을 사용하여 암호화해야 합니다.
* **백엔드/서버리스 프록시 필수:**
    * 한국투자증권 API는 **프론트엔드에서 직접 호출하지 않고**, 항상 KIS Quant의 **백엔드(Vercel Serverless Functions 또는 별도 서버)**를 통해 호출합니다.
    * 백엔드는 사용자 Firebase DB에서 암호화된 API 키를 조회하여 복호화한 후, 이를 사용하여 한국투자증권 API와 통신합니다.
    * 이 방식은 백엔드의 IP를 통해 API 요청을 보내 보안 및 Rate Limit 관리에 유리합니다.
* **Firebase 보안 규칙(Security Rules) 설정 가이드라인 제공:**
    * 사용자에게 Firebase DB를 직접 구성하도록 하므로, **KIS Quant는 사용자가 자신의 Firebase 프로젝트에 적절한 보안 규칙을 설정하도록 명확한 가이드라인을 제공**해야 합니다.
    * 예시: `allow read, write: if request.auth.uid == resource.data.userId;`와 같이 해당 사용자만이 자신의 데이터에 접근 가능하도록 하는 규칙을 설명합니다. (사용자가 Firebase 인증을 직접 사용하지 않더라도, 앱 내에서 익명 인증 등을 통해 사용자별 UID를 부여하고 이 UID를 데이터 저장 시 활용할 수 있음)
* **서비스 운영자의 정보 접근 최소화:**
    * 이 방식은 KIS Quant 서비스 운영자가 사용자의 금융 API 키나 DB 데이터에 직접 접근할 수 없도록 설계하여, **개인정보 보호 측면에서 사용자 신뢰도를 높일 수 있습니다.**

---

**참고사항:**

* **별도 회원가입/로그인 없음:** 사용자는 한국투자증권 및 Firebase 인증 정보를 직접 입력하여 서비스를 이용하며, 별도의 계정 관리(회원가입, 비밀번호 찾기 등) 기능은 없습니다.
* **서비스 유료화 없음:** MVP 단계에서는 서비스 이용료를 부과하지 않습니다.
* **초점:** MVP는 **'설정 -> 전략 구축 -> 백테스트 -> 자동매매'** 의 핵심 플로우를 끊김 없이 제공하는 데 집중합니다.
* **확장성:** 추후 고도화를 위해 각 기능은 모듈화하여 설계하는 것을 고려합니다.

---